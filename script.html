<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8BFJD2H2EH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-8BFJD2H2EH');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student PDF Portal - Analytics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }
        
        .analytics-section {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .analytics-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-top: 4px solid #3498db;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            font-size: 1rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .chart-container {
            margin-top: 20px;
            height: 300px;
        }
        
        .pages-list {
            list-style-type: none;
        }
        
        .page-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }
        
        .page-item:hover {
            background: #f9f9f9;
        }
        
        .page-name {
            font-weight: 500;
        }
        
        .page-views {
            color: #3498db;
            font-weight: bold;
        }
        
        .pdf-section {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .pdf-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .pdf-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .pdf-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background: #eef2f7;
        }
        
        .pdf-icon {
            font-size: 2.5rem;
            color: #e74c3c;
            margin-bottom: 10px;
        }
        
        .pdf-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .pdf-size {
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Student PDF Portal</h1>
            <p>Access educational materials and view usage analytics</p>
        </div>
    </header>
    
    <div class="container">
        <div class="main-content">
            <section class="analytics-section">
                <h2>Website Analytics</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Visitors</h3>
                        <div class="stat-value" id="totalVisitors">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Current Visitors</h3>
                        <div class="stat-value" id="currentVisitors">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Avg. Time on Site</h3>
                        <div class="stat-value" id="avgTime">0m</div>
                    </div>
                    <div class="stat-card">
                        <h3>Most Viewed PDF</h3>
                        <div class="stat-value" id="topPDF">-</div>
                    </div>
                </div>
                
                <h3>Most Viewed Pages</h3>
                <ul class="pages-list" id="pagesList">
                    <!-- Page items will be inserted here by JavaScript -->
                </ul>
                
                <div class="chart-container">
                    <canvas id="visitorChart"></canvas>
                </div>
            </section>
            
            <section class="pdf-section">
                <h2>Available PDFs</h2>
                <p>Click on any PDF to view it. Your visit will be tracked in our analytics.</p>
                
                <div class="pdf-list">
                    <div class="pdf-card" data-pdf="mathematics-basics.pdf">
                        <div class="pdf-icon">üìä</div>
                        <div class="pdf-title">Mathematics Basics</div>
                        <div class="pdf-size">2.4 MB</div>
                    </div>
                    <div class="pdf-card" data-pdf="physics-fundamentals.pdf">
                        <div class="pdf-icon">üî¨</div>
                        <div class="pdf-title">Physics Fundamentals</div>
                        <div class="pdf-size">3.1 MB</div>
                    </div>
                    <div class="pdf-card" data-pdf="chemistry-reactions.pdf">
                        <div class="pdf-icon">üß™</div>
                        <div class="pdf-title">Chemistry Reactions</div>
                        <div class="pdf-size">1.8 MB</div>
                    </div>
                    <div class="pdf-card" data-pdf="english-grammar.pdf">
                        <div class="pdf-icon">üìù</div>
                        <div class="pdf-title">English Grammar</div>
                        <div class="pdf-size">2.1 MB</div>
                    </div>
                    <div class="pdf-card" data-pdf="history-timeline.pdf">
                        <div class="pdf-icon">üìú</div>
                        <div class="pdf-title">History Timeline</div>
                        <div class="pdf-size">4.2 MB</div>
                    </div>
                    <div class="pdf-card" data-pdf="computer-science.pdf">
                        <div class="pdf-icon">üíª</div>
                        <div class="pdf-title">Computer Science</div>
                        <div class="pdf-size">3.7 MB</div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>Student PDF Portal &copy; 2023 | All rights reserved</p>
        </div>
    </footer>

    <!-- Include Chart.js for analytics charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Visitor Analytics System
        class VisitorAnalytics {
            constructor() {
                this.storageKey = 'studentPortalAnalytics';
                this.currentSessionId = this.generateSessionId();
                this.sessionStartTime = Date.now();
                this.initializeAnalytics();
                this.startSessionTimer();
                this.setupPDFTracking();
            }
            
            // Generate a unique session ID
            generateSessionId() {
                return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            // Initialize analytics data structure
            initializeAnalytics() {
                let analyticsData = this.getAnalyticsData();
                
                if (!analyticsData.visitors) {
                    analyticsData.visitors = 0;
                }
                
                if (!analyticsData.sessions) {
                    analyticsData.sessions = [];
                }
                
                if (!analyticsData.pageViews) {
                    analyticsData.pageViews = {};
                }
                
                // Increment visitor count for this visit
                analyticsData.visitors++;
                
                // Record this session
                analyticsData.sessions.push({
                    id: this.currentSessionId,
                    startTime: this.sessionStartTime,
                    endTime: null,
                    duration: null
                });
                
                // Record page view for current page
                const currentPage = window.location.pathname.split('/').pop() || 'index.html';
                if (!analyticsData.pageViews[currentPage]) {
                    analyticsData.pageViews[currentPage] = 0;
                }
                analyticsData.pageViews[currentPage]++;
                
                this.saveAnalyticsData(analyticsData);
                this.updateDisplay(analyticsData);
            }
            
            // Get analytics data from localStorage
            getAnalyticsData() {
                const data = localStorage.getItem(this.storageKey);
                return data ? JSON.parse(data) : {};
            }
            
            // Save analytics data to localStorage
            saveAnalyticsData(data) {
                localStorage.setItem(this.storageKey, JSON.stringify(data));
            }
            
            // Start session timer to track duration
            startSessionTimer() {
                // Update current visitors count every 5 seconds
                setInterval(() => {
                    this.updateCurrentVisitors();
                }, 5000);
                
                // Save session end time when user leaves
                window.addEventListener('beforeunload', () => {
                    this.endSession();
                });
            }
            
            // Update current visitors count
            updateCurrentVisitors() {
                const analyticsData = this.getAnalyticsData();
                
                // Count active sessions (sessions that started in the last 30 minutes)
                const thirtyMinutesAgo = Date.now() - (30 * 60 * 1000);
                const activeSessions = analyticsData.sessions.filter(session => 
                    session.startTime > thirtyMinutesAgo && (!session.endTime || session.endTime > thirtyMinutesAgo)
                );
                
                document.getElementById('currentVisitors').textContent = activeSessions.length;
            }
            
            // End current session and record duration
            endSession() {
                const analyticsData = this.getAnalyticsData();
                const sessionEndTime = Date.now();
                const sessionDuration = Math.round((sessionEndTime - this.sessionStartTime) / 1000 / 60); // in minutes
                
                // Find and update the current session
                const currentSession = analyticsData.sessions.find(session => session.id === this.currentSessionId);
                if (currentSession) {
                    currentSession.endTime = sessionEndTime;
                    currentSession.duration = sessionDuration;
                }
                
                this.saveAnalyticsData(analyticsData);
            }
            
            // Set up PDF tracking
            setupPDFTracking() {
                const pdfCards = document.querySelectorAll('.pdf-card');
                pdfCards.forEach(card => {
                    card.addEventListener('click', () => {
                        const pdfName = card.getAttribute('data-pdf');
                        this.trackPDFView(pdfName);
                        // In a real implementation, you would open the PDF here
                        alert(`Opening PDF: ${pdfName}\n\nThis view has been recorded in analytics.`);
                    });
                });
            }
            
            // Track PDF view
            trackPDFView(pdfName) {
                const analyticsData = this.getAnalyticsData();
                
                if (!analyticsData.pdfViews) {
                    analyticsData.pdfViews = {};
                }
                
                if (!analyticsData.pdfViews[pdfName]) {
                    analyticsData.pdfViews[pdfName] = 0;
                }
                
                analyticsData.pdfViews[pdfName]++;
                this.saveAnalyticsData(analyticsData);
                this.updateDisplay(analyticsData);
            }
            
            // Update the analytics display
            updateDisplay(analyticsData) {
                // Update total visitors
                document.getElementById('totalVisitors').textContent = analyticsData.visitors;
                
                // Update average time on site
                const sessionsWithDuration = analyticsData.sessions.filter(s => s.duration);
                const totalDuration = sessionsWithDuration.reduce((sum, session) => sum + session.duration, 0);
                const avgDuration = sessionsWithDuration.length > 0 ? 
                    Math.round(totalDuration / sessionsWithDuration.length) : 0;
                document.getElementById('avgTime').textContent = `${avgDuration}m`;
                
                // Update most viewed PDF
                if (analyticsData.pdfViews) {
                    const pdfs = Object.entries(analyticsData.pdfViews);
                    if (pdfs.length > 0) {
                        const topPDF = pdfs.reduce((a, b) => a[1] > b[1] ? a : b);
                        document.getElementById('topPDF').textContent = topPDF[0].replace('.pdf', '');
                    }
                }
                
                // Update page views list
                this.updatePageViewsList(analyticsData.pageViews);
                
                // Update chart
                this.updateVisitorChart(analyticsData);
            }
            
            // Update the page views list
            updatePageViewsList(pageViews) {
                const pagesList = document.getElementById('pagesList');
                pagesList.innerHTML = '';
                
                // Sort pages by view count (descending)
                const sortedPages = Object.entries(pageViews)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5); // Show top 5 pages
                
                sortedPages.forEach(([page, views]) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'page-item';
                    listItem.innerHTML = `
                        <span class="page-name">${page}</span>
                        <span class="page-views">${views} views</span>
                    `;
                    pagesList.appendChild(listItem);
                });
            }
            
            // Update the visitor chart
            updateVisitorChart(analyticsData) {
                const ctx = document.getElementById('visitorChart').getContext('2d');
                
                // Generate sample data for the last 7 days
                const labels = [];
                const data = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                    
                    // In a real implementation, you would use actual historical data
                    // For demo purposes, we're generating random data
                    data.push(Math.floor(Math.random() * 20) + 5);
                }
                
                // Create or update the chart
                if (this.visitorChart) {
                    this.visitorChart.destroy();
                }
                
                this.visitorChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Daily Visitors',
                            data: data,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 5
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Initialize analytics when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new VisitorAnalytics();
        });
    </script>
</body>
</html>